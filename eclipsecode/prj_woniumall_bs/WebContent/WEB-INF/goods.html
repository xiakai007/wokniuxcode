<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Insert title here</title>
<link href="static/css/bootstrap.min.css" type="text/css" rel="stylesheet"/>
</head>
<body>
   <div style="width:95%;margin:5px auto;">
     <form method="post" name="form1">
       <input type="text" name="name" placeholder="请输入图书名称" id="searchName"/>
       <input type="text" name="author" placeholder="请输入图书作者" id="searchAuthor"/>
       <input type="text" name="publisher" placeholder="请输入图书出版社" id="searchPublisher"/>
       <input type="button" value="查询" class="btn btn-primary" id="searchInfo"/>
     </form>
   </div>
   <div style="width:95%;margin:5px auto;text-align:right;">
     <button class="btn btn-success" type="button" id="goods_add_btn">增加</button>
     <button class="btn btn-danger" type="button" id="goods_deleteAll_btn">批量删除</button>
   </div>
   <table class="table table-striped table-bordered table-hover" style="width:95%;margin:5px auto;" id="table1">
      <thead>
         <tr>
           <th>
             <input type="checkbox" name="selectAll"/>全选
             <input type="button" class="btn btn-inverse btn-xs" value="反选" id="btn_inverse">
           </th>
           <th>图书id</th>
           <th>图书名称</th>
           <th>图书编号</th>
           <th>图书作者</th>
           <th>出版社</th>
           <th>类别id</th>
           <th>类别名称</th>
           <th>图书照片</th>
           <th>最新</th>
           <th>热卖</th>
           <th>操作</th>
         </tr>
      </thead>
      <tbody>
         
      </tbody>
   </table>
   <div style="width:70%;margin:0px auto;">
     <ul class="pagination pull-right" id="ul1">
       <li >
         <a href="" >
           
         </a>
       </li>
     </ul>
   </div>
   <!-- 商品增加模态框开始 -->
   <div class="modal fade" tabindex="-1" role="dialog" id="goodsAddModal">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title">增加商品</h4>
	      </div>
	      <div class="modal-body">
			 <form class="form-horizontal" method="post" id="goodsAddForm"> 
					<div class="form-group">
						<label class="col-sm-4 control-label">图书名称：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="name">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">图书编号：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="goodsno">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">图书作者：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="author">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">出版社：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="publisher">
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label">类别名称：</label>
						<div class="col-sm-6 " id="div_selectType_add">
							<select name="categoryid" class="form-control">
							  
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">图书照片：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="image">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">是否最新：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="newest">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">是否热卖：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="hot">
						</div>
					</div>
					<input type="hidden" name="oper" value="goodsAddSave"/>
			</form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-primary" id="goods_addsave_btn">保存</button>
	        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
	      </div>
	    </div><!-- /.modal-content -->
	  </div><!-- /.modal-dialog -->
   </div><!-- /.modal -->
   <!-- 商品增加模态框结束 -->
   <!-- 商品修改模态框开始 -->
   <div class="modal fade" tabindex="-1" role="dialog" id="goodsUpdModal">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title">修改商品</h4>
	      </div>
	      <div class="modal-body">
			 <form class="form-horizontal" method="post" id="goodsUpdForm"> 
					<div class="form-group">
						<label class="col-sm-4 control-label">图书名称：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="name">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">图书编号：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="goodsno">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">图书作者：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="author">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">出版社：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="publisher">
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label">类别名称：</label>
						<div class="col-sm-6 " id="div_selectCategory_add">
							<select name="categoryid" class="form-control">
							  
							</select>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">图书照片：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="image">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">是否最新：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="newest">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-4 control-label">是否热卖：</label>
						<div class="col-sm-6 ">
							<input type="text" class="form-control"  required="required" name="hot">
						</div>
					</div>
					<input type="hidden" name="oper" value="goodsUpdSave"/>
					<input type="hidden" name="id"/>
			</form>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-primary" id="goods_updsave_btn">保存</button>
	        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
	      </div>
	    </div><!-- /.modal-content -->
	  </div><!-- /.modal-dialog -->
   </div><!-- /.modal -->
   <!-- 商品修改模态框结束 -->

   <script type="text/javascript" src="static/js/jquery-1.12.3.min.js"></script>
   <script type="text/javascript" src="static/js/bootstrap.min.js"></script>
   <script type="text/javascript">
   //展示商品列表
   loadGoodsList(1);
   //查询
   searchData();
   //增加商品模态框显示
   showAddGoodsModal();
   //增加商品模态框保存
   saveAddGoodsModal();
   //增加商品模态框保存后重置表单数据
   goodsAddHide();
   //批量删除商品
   deleteAllGoods();
   //选择商品
   selectGoods();
   //修改-保存数据至服务器
   updateGoodsSave();
   
   /*展示商品列表*/
   function loadGoodsList(crtPage){
	   $.ajax({
		   type:"post",
		   url:"goods",
		   dataType:"json",
		   data:{"oper":"goodslist","name":$("#searchName").val(),
			   "author":$("#searchAuthor").val(),"publisher":$("#searchPublisher").val(),"currentPage":crtPage},
		   error:function(){
			   alert("加载商品列表报错");
		   },
		   success:function(resp){
			   var goodsArr=resp.pageData;
			   var tr="";
			   for(var i=0;i<goodsArr.length;i++){
				   tr=tr+"<tr>";
				   tr=tr+"<td><input type=checkbox name=id value="+goodsArr[i].id+" /></td>";
				   tr=tr+"<td>"+goodsArr[i].id+"</td>";
				   tr=tr+"<td>"+goodsArr[i].name+"</td>";
				   tr=tr+"<td>"+goodsArr[i].goodsno+"</td>";
				   tr=tr+"<td>"+goodsArr[i].author+"</td>";
				   tr=tr+"<td>"+goodsArr[i].publisher+"</td>";
				   tr=tr+"<td>"+goodsArr[i].categoryid+"</td>";
				   tr=tr+"<td>"+goodsArr[i].categoryname+"</td>";
				   tr=tr+"<td><img src='"+goodsArr[i].image+"' width='135px' height='160px'/></td>";
				   tr=tr+"<td>"+goodsArr[i].newest+"</td>";
				   tr=tr+"<td>"+goodsArr[i].hot+"</td>";
				   tr=tr+"<td><button class='btn btn-danger btn-xs' name=goods_delete_btn>删除</button>";
				   tr=tr+"&nbsp;&nbsp;<button class='btn btn-info btn-xs' name=goods_update_btn>修改</button></td>";
				   tr=tr+"</tr>";
			   }
			   $("#table1 tbody").html(tr);
			   var pageStr="<li><a href="+(resp.currentPage-1)+">&laquo;</a></li>";
			   for(var i=1;i<=resp.pages;i++){
				   if(i==resp.currentPage){
					   pageStr=pageStr+"<li class=active><a>"+i+"</a></li>";
				   }else{
					   pageStr=pageStr+"<li><a href="+i+">"+i+"</a></li>";
				   }
			   }
			   pageStr=pageStr+"<li><a href="+(resp.currentPage+1)+">&raquo;</a></li>";
			   $("#ul1").html(pageStr);
			   //页签单击事件
			   pageClick();
			   //删除商品
			   deleteGoods();
			   //修改-从服务器获取数据
			   updateGoods();
		   }
	   });
   }
   /*页签单击事件*/
   function pageClick(){
	   $("#ul1 a").click(function(){
		   var crtPage=$(this).attr("href");
		   loadGoodsList(crtPage);
		   return false;
	   });
   }
   /*查询*/
   function searchData(){
	   $("#searchInfo").click(function(){
		   loadGoodsList(1);
	   });
   }
   /*增加商品模态框显示*/
   function showAddGoodsModal(){
	   $("#goods_add_btn").click(function(){
		   loadTypeList();
		   $("#goodsAddModal").modal("show");
	   });
   }
   function loadTypeList(){
	   $.ajax({
		   type:"post",
		   url:"types",
		   data:{"oper":"showTypes"},
		   dataType:"json",
		   error:function(){
			   alert("错误");
		   },
		   success:function(resp){
			   var opt="<option>请选择类型名称</option>";
			   for(var i=0;i<resp.length;i++){
				   opt=opt+"<option value="+resp[i].id+">"+resp[i].name+"</option>"
			   }
			   $("#div_selectType_add select").html(opt);
		   }
	   });
   }
   /*增加商品模态框保存*/
   function saveAddGoodsModal(){
	   $("#goods_addsave_btn").click(function(){
		   $.ajax({
			   type:"post",
			   url:"goods",
			   data:$("#goodsAddForm").serialize(),
			   error:function(){
				   alert("增加保存报错");
			   },
			   success:function(data){
				   alert(data);
				   $("#goodsAddModal").modal("hide");
				   loadGoodsList(1);
			   }
		   });
	   });
   }
   /*增加商品模态框保存后重置表单数据*/
   function goodsAddHide(){
	   $("#goodsAddModal").on("hidden.bs.modal",function(e){
		   $("#goodsAddForm")[0].reset();
	   });
   }
   /*删除商品*/
   function deleteGoods(){
	   $("button[name=goods_delete_btn]").click(function(){
		   if(confirm("确认删除？")){
		   var id=$(this).parents("tr").children().first().next().text();
		   $.ajax({
			   type:"post",
			   url:"goods",
			   data:{"oper":"delete","id":id},
			   error:function(){
				   alert("删除商品报错");
			   },
			   success:function(data){
				   alert(data);
				   loadGoodsList(1);
			   }
		   });
		   }
	   });
   }
   /*选择商品*/
   function selectGoods(){
	   $(":checkbox[name=selectAll]").click(function(){
		   var flag=$(this).prop("checked");
		   $(":checkbox[name=id]").prop("checked",flag);
	   });
	   $("#btn_inverse").click(function(){
		   $(":checkbox[name=id]").each(function(){
			   if($(this).prop("checked")){
				   $(this).removeProp("checked");
			   }else{
				   $(this).prop("checked","true");
			   }
		   });
	   });
   }
   /*批量删除商品*/
   function deleteAllGoods(){
	   $("#goods_deleteAll_btn").click(function(){
		   if($(":checkbox[name=id]:checked").length>0){
			   if(confirm("确认批量删除？")){
				   var goodsIdArr=new Array();
				   $(":checkbox[name=id]:checked").each(function(){
					   goodsIdArr.push($(this).val());
				   });
				   $.ajax({
					   type:"post",
					   url:"goods",
					   data:{"oper":"deleteAll","goodsIds":goodsIdArr.join(",")},
					   error:function(){
						   alert("批量删除商品报错");
					   },
					   success:function(data){
						   alert(data);
						   loadGoodsList(1);
					   }
				   });
			   }
		   }else{
			   alert("请选择批量删除记录");
		   }
	   });
   }
   /*修改-从服务器获取数据*/
   function updateGoods(){
	   $("button[name=goods_update_btn]").click(function(){
		   var id=$(this).parents("tr").find(":checkbox[name=id]").val();
		   $.ajax({
			   type:"post",
			   url:"goods",
			   data:{"oper":"updUI","id":id},
			   dataType:"json",
			   error:function(){
				   alert("获取更新数据报错");
			   },
			   success:function(data){
				   var optCategory="<option>请选择类型名称</option>";
				   /*var select="";*/
				   for(var i=0;i<data.category.length;i++){
					   /*alert(data.types[i].type_id+"---types[i].type_id")
					   alert(data.goods.type_id+"---goods.type_id")
					   if(data.types[i].type_id===data.goods.type_id){
						   select=select+" selected=\"selected\"";
					   }
					   optType=optType+"<option value="+data.types[i].type_id+select+">"+data.types[i].type_name+"</option>"*/
					   optCategory=optCategory+"<option value="+data.category[i].id+">"+data.category[i].name+"</option>"
				   }
				   $("#div_selectCategory_add select").html(optCategory);
				   
				   $("#goodsUpdForm :text[name=name]").val(data.goods.name);
				   $("#goodsUpdForm :text[name=goodsno]").val(data.goods.goodsno);
				   $("#goodsUpdForm :text[name=author]").val(data.goods.author);
				   $("#goodsUpdForm :text[name=publisher]").val(data.goods.publisher);
				   $("#goodsUpdForm :text[name=categoryid]").val(data.goods.categoryid);
				   $("#goodsUpdForm :text[name=image]").val(data.goods.image);
				   $("#goodsUpdForm :text[name=newest]").val(data.goods.newest);
				   $("#goodsUpdForm :text[name=hot]").val(data.goods.hot);
				   $("#goodsUpdForm :hidden[name=id]").val(data.goods.id);
			   }
		   });
		   $("#goodsUpdModal").modal("show");
	   });
   }
   /*修改-保存数据至服务器*/
   function updateGoodsSave(){
	   $("#goods_updsave_btn").click(function(){
		   $.ajax({
			   type:"post",
			   url:"goods",
			   data:$("#goodsUpdForm").serialize(),
			   error:function(){
				   alert("修改保存报错");
			   },
			   success:function(data){
				   alert(data);
				   $("#goodsUpdModal").modal("hide");
				   loadGoodsList(1);
			   }
		   });
	   });
   }
   </script>
</body>
</html>